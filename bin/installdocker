#!/usr/bin/env python

import sys
import os

import dockerparse

if len(sys.argv) < 2:
    print "Usage: setup.sh <chroot_dir> <Dockerfile>"
    sys.exit(1)

chrootdir = sys.argv[1]
dockerfile = sys.argv[2]

with open(dockerfile, 'r') as f:
    parsed = dockerparse.parse_dockerfile(f.read())

repopath = os.path.normpath('~/.rgrepo')
os.link(repopath, os.path.join(chrootdir, '.rgrepo'))
dockercontext = '.rgrepo'

script = '\n'.join(generate_script_from_parsed_dockerfile_lines(dockercontext, parsed['lines']))
with open(os.path.join(chrootdir, '.rgsetup')) as f:
    f.write('#!/bin/sh\nscript')

